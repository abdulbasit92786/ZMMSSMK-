<!--ðŸ‘‡ Ù¾Ú†Ú¾Ù„Ø§ ÛÛŒ ÛÛŒÚˆ/HTML Ø§Ø³Ù¹Ø§Ø¦Ù„ Ù¹Ú¾ÛŒÚ© ÛÛ’ØŒ ØµØ±Ù JS Ú©Û’ Ø¢Ø®Ø± Ù…ÛŒÚº ÛŒÛ Ú†ÛŒÙ†Ø¬ Ú©Ø±ÛŒÚº -->

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyBN4LbA8udE4POVTR-XlZgpHQOvuNcSMI4",
    authDomain: "zmmssmk.firebaseapp.com",
    databaseURL: "https://zmmssmk-default-rtdb.firebaseio.com",
    projectId: "zmmssmk",
    storageBucket: "zmmssmk.appspot.com",
    messagingSenderId: "677420760492",
    appId: "1:677420760492:web:2c27c0f0ed6490b8dfce09",
    measurementId: "G-7J7BEDY8H1"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  const auth = firebase.auth();

  const claimCooldown = 4 * 60 * 60;
  const countdownEl = document.getElementById("countdown");
  const claimBtn = document.getElementById("claimBtn");
  const balanceEl = document.getElementById("balance");
  const earnedEl = document.getElementById("totalEarned");
  const claimToWalletBtn = document.getElementById("claimToWalletBtn");

  let currentUserId = null;

  auth.onAuthStateChanged((user) => {
    if (user) {
      currentUserId = user.uid;
      loadUserData();
    } else {
      alert("Please log in first");
      window.location.href = "login.html";
    }
  });

  function copyLink() {
    const refLink = document.getElementById("refLink");
    refLink.select();
    document.execCommand("copy");
    alert("Referral link copied!");
  }

  function getRewardForPlan(planKey) {
    if (!planKey || planKey === "Free") return 0.5;
    const parts = planKey.split("_");
    const amount = parseFloat(parts[2]);
    switch (amount) {
      case 10: case 1000: return 2;
      case 25: case 2500: return 4;
      case 50: case 5000: return 6;
      case 100: case 10000: return 12;
      case 500: case 50000: return 20;
      default: return 0.5;
    }
  }

  function updateUI(data) {
    const zmmBalance = data.zmm_balance || 0;
    const totalEarned = data.total_earned || 0;

    balanceEl.textContent = zmmBalance.toFixed(2);
    earnedEl.textContent = `Total Earned: ${totalEarned.toFixed(2)} ZMM`;

    claimToWalletBtn.disabled = totalEarned < 20;
  }

  function loadUserData() {
    db.ref("users/" + currentUserId).once("value").then(snapshot => {
      const data = snapshot.val() || {};
      updateUI(data);

      const lastClaim = data.last_claim_time || 0;
      const now = Date.now();
      if ((now - lastClaim) / 1000 < claimCooldown) {
        claimBtn.disabled = true;
        startCountdown(Math.floor(claimCooldown - (now - lastClaim) / 1000));
      }
    });
  }

  function claimReward() {
    db.ref("users/" + currentUserId).once("value").then(snapshot => {
      const data = snapshot.val() || {};
      const planKey = data.plan || "Free";
      const reward = getRewardForPlan(planKey);
      const now = Date.now();

      const newBalance = (data.zmm_balance || 0) + reward;
      const newTotal = (data.total_earned || 0) + reward;

      db.ref("users/" + currentUserId).update({
        zmm_balance: newBalance,
        total_earned: newTotal,
        last_claim_time: now
      });

      claimBtn.disabled = true;
      updateUI({ zmm_balance: newBalance, total_earned: newTotal });
      startCountdown(claimCooldown);
    });
  }

  function startCountdown(seconds) {
    let interval = setInterval(() => {
      let h = Math.floor(seconds / 3600);
      let m = Math.floor((seconds % 3600) / 60);
      let s = seconds % 60;
      countdownEl.textContent = `Next claim in ${h}h ${m}m ${s}s`;
      if (--seconds < 0) {
        clearInterval(interval);
        countdownEl.textContent = "";
        claimBtn.disabled = false;
      }
    }, 1000);
  }

  function claimToWallet() {
    db.ref("users/" + currentUserId).once("value").then(snapshot => {
      const data = snapshot.val() || {};
      let total = data.total_earned || 0;
      if (total < 20) return alert("Minimum 20 ZMM required to claim to wallet.");

      const amountToClaim = Math.min(100, total);
      const newWallet = (data.wallet_balance || 0) + amountToClaim;
      const newZmm = (data.zmm_balance || 0) - amountToClaim;
      const newTotal = total - amountToClaim;

      db.ref("users/" + currentUserId).update({
        wallet_balance: newWallet,
        zmm_balance: newZmm,
        total_earned: newTotal
      });

      alert(`${amountToClaim} ZMM claimed to wallet!`);
      updateUI({ zmm_balance: newZmm, total_earned: newTotal });
    });
  }
</script>
