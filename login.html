<!-- ✅ login.html (Firebase v9 compat version) -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Login</title>

  <!-- ✅ Firebase compat version (same as dashboard.html) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
</head>
<body>
  <h2>Login</h2>
  <input type="email" id="loginEmail" placeholder="Enter your email" />
  <input type="password" id="loginPassword" placeholder="Enter your password" />
  <button id="loginBtn">Login</button>

  <script>
    // ✅ Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyAL9a_aE-zpelXpMIl0iAWD4Abrxf8e_2U",
      authDomain: "zmmssmk.firebaseapp.com",
      databaseURL: "https://zmmssmk-default-rtdb.firebaseio.com",
      projectId: "zmmssmk",
      storageBucket: "zmmssmk.appspot.com",
      messagingSenderId: "677420760492",
      appId: "1:677420760492:web:2c27c0f0ed6490b8dfce09",
      measurementId: "G-7J7BEDY8H1"
    };

    // ✅ Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // ✅ Login logic
    document.getElementById("loginBtn").addEventListener("click", async () => {
      const email = document.getElementById("loginEmail").value.trim();
      const password = document.getElementById("loginPassword").value.trim();

      if (!email || !password) {
        alert("Please enter both email and password.");
        return;
      }

      try {
        const snapshot = await db.ref("users").orderByChild("email").equalTo(email).once("value");

        if (snapshot.exists()) {
          let userFound = false;

          snapshot.forEach((childSnapshot) => {
            const userData = childSnapshot.val();
            if (userData.password === password) {
              userFound = true;

              // ✅ Save login session
              localStorage.setItem("telegram_user_id", childSnapshot.key);
              localStorage.setItem("user_email", userData.email);
              localStorage.setItem("user_balance", userData.balance || 0);

              alert("✅ Login successful!");

              // ✅ Redirect after delay
              setTimeout(() => {
                window.location.href = "dashboard.html";
              }, 500);
            }
          });

          if (!userFound) {
            alert("❌ Incorrect password.");
          }

        } else {
          alert("❌ Email not registered.");
        }

      } catch (error) {
        console.error("Login Error:", error);
        alert("⚠️ Something went wrong. Please try again.");
      }
    });
  </script>
</body>
</html>
